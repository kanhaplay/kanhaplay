<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kanha Play — Login / Signup</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f8fafc; color:#111; }
    header { display:flex; justify-content:space-between; align-items:center; padding:12px 18px; background:#fff; box-shadow:0 1px 6px rgba(0,0,0,0.06);}
    #logo { font-weight:700; font-size:18px; color:#0b5; }
    button { padding:8px 12px; border-radius:6px; border: none; cursor:pointer; background:#2563eb; color:#fff; }
    button.secondary { background:#10b981; }
    .hidden { display:none; }
    .modal { display:none; position:fixed; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.5); align-items:center; justify-content:center; z-index:50; }
    .modal .box { background:#fff; width:360px; padding:18px; border-radius:10px; box-shadow:0 6px 24px rgba(0,0,0,0.14); }
    input[type="email"], input[type="password"], input[type="text"] { width:100%; padding:10px; margin:6px 0 12px; border:1px solid #ddd; border-radius:6px; }
    .close { float:right; cursor:pointer; font-size:18px; color:#666; }
    .error { color:#b91c1c; font-size:13px; min-height:18px; }
    .success { color:#065f46; font-size:13px; min-height:18px; }
    footer { padding:12px 18px; text-align:center; font-size:13px; color:#666; margin-top:30px; }
  </style>
</head>
<body>

  <header>
    <div id="logo">Kanha Play</div>
    <div id="authButtons">
      <button id="loginBtn">Login</button>
      <button id="signupBtn" class="secondary">Sign Up</button>
    </div>
    <div id="userPanel" class="hidden">
      <span id="userEmail" style="margin-right:12px;"></span>
      <button id="logoutBtn">Logout</button>
    </div>
  </header>

  <main style="padding:20px;">
    <h1>Welcome to Kanha Play</h1>
    <p>Interactive & gamified learning platform. Login or Sign up to get started.</p>
  </main>

  <!-- Login Modal -->
  <div id="loginModal" class="modal" aria-hidden="true">
    <div class="box">
      <span class="close" data-close="loginModal">&times;</span>
      <h2>Login</h2>
      <form id="loginForm">
        <input id="loginEmail" type="email" placeholder="Email" required />
        <input id="loginPassword" type="password" placeholder="Password" required />
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <a href="#" id="forgotLink" style="font-size:13px;">Forgot password?</a>
        </div>
        <div id="loginError" class="error"></div>
        <button type="submit">Login</button>
      </form>
    </div>
  </div>

  <!-- Signup Modal -->
  <div id="signupModal" class="modal" aria-hidden="true">
    <div class="box">
      <span class="close" data-close="signupModal">&times;</span>
      <h2>Sign Up</h2>
      <form id="signupForm">
        <input id="signupName" type="text" placeholder="Full name (optional)" />
        <input id="signupEmail" type="email" placeholder="Email" required />
        <input id="signupPassword" type="password" placeholder="Password (min 6 chars)" required />
        <div id="signupError" class="error"></div>
        <div id="signupSuccess" class="success"></div>
        <button type="submit">Create account</button>
      </form>
    </div>
  </div>

  <!-- Password Reset Modal -->
  <div id="resetModal" class="modal" aria-hidden="true">
    <div class="box">
      <span class="close" data-close="resetModal">&times;</span>
      <h2>Reset Password</h2>
      <form id="resetForm">
        <input id="resetEmail" type="email" placeholder="Email" required />
        <div id="resetMsg" class="success"></div>
        <div id="resetError" class="error"></div>
        <button type="submit">Send Reset Email</button>
      </form>
    </div>
  </div>

  <footer>© Kanha Play</footer>

  <!-- Firebase & App logic -->
  <script type="module">
    // IMPORTS (CDN)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getAuth,
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged,
      sendEmailVerification,
      sendPasswordResetEmail
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // ---- PASTE YOUR FIREBASE CONFIG OBJECT HERE ----
    // Import the functions you need from the SDKs you need
<script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-analytics.js";
  import { getAuth } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAOygIr6d3O9fUh-Gs7SAJyAc1sbDdLB8w",
    authDomain: "kanhaplay-d1026.firebaseapp.com",
    projectId: "kanhaplay-d1026",
    storageBucket: "kanhaplay-d1026.firebasestorage.app",
    messagingSenderId: "850483473532",
    appId: "1:850483473532:web:ae88b0785f7510e2a22df9",
    measurementId: "G-FRB49CJJCM"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
</script>

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
    // ------------------------------------------------

    // Initialize
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // DOM refs
    const loginBtn = document.getElementById('loginBtn');
    const signupBtn = document.getElementById('signupBtn');
    const loginModal = document.getElementById('loginModal');
    const signupModal = document.getElementById('signupModal');
    const resetModal = document.getElementById('resetModal');
    const userPanel = document.getElementById('userPanel');
    const authButtons = document.getElementById('authButtons');
    const userEmailSpan = document.getElementById('userEmail');
    const logoutBtn = document.getElementById('logoutBtn');

    function openModal(id){ const el=document.getElementById(id); el.style.display='flex'; el.setAttribute('aria-hidden','false'); }
    function closeModal(id){ const el=document.getElementById(id); el.style.display='none'; el.setAttribute('aria-hidden','true'); 
      if(id==='signupModal') { document.getElementById('signupError').textContent=''; document.getElementById('signupSuccess').textContent=''; }
      if(id==='loginModal') document.getElementById('loginError').textContent='';
      if(id==='resetModal'){ document.getElementById('resetError').textContent=''; document.getElementById('resetMsg').textContent=''; }
    }

    loginBtn.addEventListener('click', ()=>openModal('loginModal'));
    signupBtn.addEventListener('click', ()=>openModal('signupModal'));
    document.querySelectorAll('.close').forEach(el=>el.addEventListener('click', e=>closeModal(e.target.dataset.close)));
    document.getElementById('forgotLink').addEventListener('click', (e)=>{ e.preventDefault(); openModal('resetModal'); });

    // SIGNUP — create user, send verification, save profile to Firestore
    document.getElementById('signupForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;
      const signupError = document.getElementById('signupError');
      const signupSuccess = document.getElementById('signupSuccess');
      signupError.textContent=''; signupSuccess.textContent='';

      try {
        const userCred = await createUserWithEmailAndPassword(auth, email, password);
        // Send verification email
        await sendEmailVerification(userCred.user);
        // Save a small profile in Firestore
        try {
          await setDoc(doc(db, 'users', userCred.user.uid), {
            name: name || null,
            email: email,
            createdAt: serverTimestamp(),
            points: 0
          });
        } catch (fireErr) {
          console.warn('Could not save profile to Firestore:', fireErr);
        }
        signupSuccess.textContent = 'Account created — verification email sent. Check inbox.';
        setTimeout(()=>closeModal('signupModal'), 1500);
      } catch (err) {
        signupError.textContent = err.message;
        console.error('Signup error', err);
      }
    });

    // LOGIN — if not verified, sign out & show message
    document.getElementById('loginForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const password = document.getElementById('loginPassword').value;
      const loginError = document.getElementById('loginError');
      loginError.textContent='';

      try {
        const credential = await signInWithEmailAndPassword(auth, email, password);
        if(!credential.user.emailVerified){
          // require verification before allowing full access
          loginError.textContent = 'Please verify your email first (check your inbox).';
          await signOut(auth);
        } else {
          closeModal('loginModal');
        }
      } catch (err) {
        loginError.textContent = err.message;
        console.error('Login error', err);
      }
    });

    // PASSWORD RESET
    document.getElementById('resetForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const email = document.getElementById('resetEmail').value.trim();
      const resetError = document.getElementById('resetError');
      const resetMsg = document.getElementById('resetMsg');
      resetError.textContent=''; resetMsg.textContent='';

      try {
        await sendPasswordResetEmail(auth, email);
        resetMsg.textContent = 'Password reset email sent — check your inbox.';
        setTimeout(()=>closeModal('resetModal'), 1200);
      } catch (err) {
        resetError.textContent = err.message;
        console.error('Reset error', err);
      }
    });

    // LOGOUT
    logoutBtn.addEventListener('click', async ()=>{
      try { await signOut(auth); } catch(err){ console.error('Logout error', err); }
    });

    // AUTH STATE — update UI
    onAuthStateChanged(auth, (user)=>{
      if(user){
        authButtons.classList.add('hidden');
        userPanel.classList.remove('hidden');
        userEmailSpan.textContent = user.email + (user.emailVerified ? '' : ' (unverified)');
        console.log('User signed in:', user.uid, user.email);
      } else {
        authButtons.classList.remove('hidden');
        userPanel.classList.add('hidden');
        userEmailSpan.textContent = '';
        console.log('No user signed in');
      }
    });

    // click outside to close
    window.addEventListener('click', (e)=>{
      if(e.target===loginModal) closeModal('loginModal');
      if(e.target===signupModal) closeModal('signupModal');
      if(e.target===resetModal) closeModal('resetModal');
    });

  </script>
</body>
</html>
